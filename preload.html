<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Battle Simulator v3.0</title>
    <style>
        :root {
            --hive-blue: #00f7ff;
            --dna-pink: #ff00ff;
            --matrix-green: #00ff00;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            touch-action: manipulation;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .battle-screen {
            border: 2px solid var(--hive-blue);
            padding: 20px;
            margin: 20px 0;
            position: relative;
            background: rgba(0,0,0,0.8);
        }

        .health-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .health-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--dna-pink), var(--hive-blue));
            transition: width 0.3s;
        }

        .skills-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .skill-button {
            background: rgba(0, 247, 255, 0.3);
            border: 1px solid var(--hive-blue);
            color: white;
            padding: 10px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border-radius: 5px;
        }

        .skill-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .cooldown-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            background: rgba(255,0,255,0.5);
            width: 100%;
            transition: height 0.3s linear;
        }

        .upgrade-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px;
            border: 2px solid var(--matrix-green);
            z-index: 1000;
        }

        .upgrade-button {
            display: block;
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0,255,0,0.2);
            border: 1px solid var(--matrix-green);
            color: white;
            cursor: pointer;
        }

        .enemy-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,0,0,0.3);
            padding: 5px 10px;
            border-radius: 5px;
        }

        @media (max-width: 600px) {
            .skills-container {
                grid-template-columns: 1fr;
            }
            
            .battle-screen {
                padding: 10px;
            }
            
            button {
                min-width: 60px;
                padding: 12px;
            }
        }

        /* Existing animations remain */
    </style>
</head>
<body>
    <div class="container">
        <div id="game-screen">
            <h1>Quantum Battle Simulator</h1>
            <div class="battle-screen">
                <div class="enemy-info" id="enemy-type"></div>
                <div id="wave-display">Wave: <span>1</span></div>
                <div class="health-bar">
                    <div class="health-bar-fill" style="width: 100%"></div>
                </div>
                <div class="battle-visual">
                    <span>ü§ñ</span> vs <span id="enemy-emote">üëæ</span>
                </div>
                <div class="skills-container" id="skills-container"></div>
                <div id="battle-log"></div>
            </div>
            <div class="stats">
                <div>Level: <span id="level">1</span></div>
                <div>Score: <span id="score">0</span></div>
                <div>Attack: <span id="attack">10</span></div>
                <div>Defense: <span id="defense">5</span></div>
            </div>
        </div>
    </div>

    <div class="upgrade-menu" id="upgrade-menu">
        <h3>Choose Upgrade</h3>
        <button class="upgrade-button" data-stat="attack" data-cost="50">+5 Attack (50)</button>
        <button class="upgrade-button" data-stat="defense" data-cost="50">+3 Defense (50)</button>
        <button class="upgrade-button" data-stat="health" data-cost="75">+50 Health (75)</button>
        <button class="upgrade-button" id="close-upgrades">Continue Fighting</button>
    </div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Sound effects
        const playSound = (frequency, duration) => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            
            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.stop(audioContext.currentTime + duration);
        };

        let gameState = {
            level: 1,
            score: 0,
            xp: 0,
            nextLevel: 100,
            attack: 10,
            defense: 5,
            maxHealth: 100,
            currentHealth: 100,
            skills: [],
            activeCooldowns: {},
            enemiesDefeated: 0
        };

        const enemyTypes = [
            {
                name: "Quantum Drone",
                emote: "üëæ",
                hp: 50,
                attack: 8,
                defense: 2,
                ability: null
            },
            {
                name: "Neural Parasite",
                emote: "ü¶†",
                hp: 30,
                attack: 15,
                defense: 1,
                ability: "lifeSteal"
            },
            {
                name: "Singularity Titan",
                emote: "üõ°Ô∏è",
                hp: 150,
                attack: 5,
                defense: 10,
                ability: "damageReflect"
            }
        ];

        const skillTree = [
            { 
                name: "Quantum Strike", 
                level: 2, 
                effect: { type: "damage", multiplier: 2 }, 
                cooldown: 10 
            },
            { 
                name: "Temporal Shield", 
                level: 5, 
                effect: { type: "defense", multiplier: 3 }, 
                cooldown: 15 
            }
        ];

        let currentEnemy = null;
        let battleInterval = null;

        function spawnEnemy() {
            currentEnemy = {...enemyTypes[Math.floor(Math.random() * enemyTypes.length)]};
            currentEnemy.hp += gameState.level * 5;
            currentEnemy.attack += gameState.level;
            document.getElementById('enemy-emote').textContent = currentEnemy.emote;
            document.getElementById('enemy-type').textContent = currentEnemy.name;
            updateHealthBars();
        }

        function attackEnemy() {
            if (battleInterval) return;

            playSound(440, 0.1);
            let damage = Math.max(gameState.attack - currentEnemy.defense, 1);
            
            if (Math.random() < 0.2 + (gameState.level * 0.01)) {
                damage *= 2;
                showCriticalPopup(damage);
                playSound(880, 0.2);
            }

            currentEnemy.hp -= damage;
            updateHealthBars();
            
            if (currentEnemy.hp <= 0) {
                handleVictory();
                return;
            }

            battleInterval = setTimeout(() => enemyAttack(), 1000);
        }

        function enemyAttack() {
            let damage = Math.max(currentEnemy.attack - gameState.defense, 1);
            
            if (currentEnemy.ability === 'lifeSteal') {
                currentEnemy.hp += damage;
            }
            
            if (currentEnemy.ability === 'damageReflect') {
                damage = Math.floor(damage * 0.5);
            }

            gameState.currentHealth -= damage;
            updateHealthBars();
            
            if (gameState.currentHealth <= 0) {
                gameOver();
                return;
            }

            battleInterval = null;
        }

        function updateHealthBars() {
            const playerHealth = document.querySelector('.health-bar-fill');
            const enemyHealth = document.querySelector('#enemy-health');
            
            playerHealth.style.width = `${(gameState.currentHealth / gameState.maxHealth) * 100}%`;
            if (enemyHealth) {
                enemyHealth.style.width = `${(currentEnemy.hp / currentEnemy.maxHp) * 100}%`;
            }
        }

        function showUpgrades() {
            const menu = document.getElementById('upgrade-menu');
            menu.style.display = 'block';
            
            document.querySelectorAll('.upgrade-button').forEach(button => {
                if (button.dataset.stat) {
                    button.disabled = gameState.score < parseInt(button.dataset.cost);
                }
            });
        }

        // Initialize game
        function init() {
            spawnEnemy();
            document.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', () => playSound(220, 0.05));
            });
            
            document.getElementById('upgrade-menu').addEventListener('click', (e) => {
                if (e.target.dataset.stat) {
                    const cost = parseInt(e.target.dataset.cost);
                    if (gameState.score >= cost) {
                        gameState[e.target.dataset.stat] += parseInt(e.target.textContent.match(/\+(\d+)/)[1]);
                        gameState.score -= cost;
                        updateUI();
                    }
                }
                document.getElementById('upgrade-menu').style.display = 'none';
            });
        }

        init();
    </script>
</body>
</html>
